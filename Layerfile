#Use an Ubuntu 18.04 base for our staging server
FROM vm/ubuntu:22.04

# To note: Layerfiles create entire VMs, *not* containers!

# Install Node.js and npm
RUN curl -sL https://deb.nodesource.com/setup_14.x | bash -
RUN apt-get update && apt-get install -y nodejs

RUN npm install -g @vue/cli

# Install php5 & composer
RUN apt-get update && \
    apt-get install software-properties-common && \
    yes | add-apt-repository ppa:ondrej/php && \
    apt-get update && \
    apt-get install -y \
    curl \
    php8.2-cli \
    php8.2-mbstring \
    php8.2-zip \
    php8.2-dom \
    php8.2-curl \
    php8.2-sqlite3 \
    git \
    unzip
RUN curl -sS https://getcomposer.org/installer -o composer-setup.php && \
    php composer-setup.php --install-dir=/usr/local/bin --filename=composer && \
    rm composer-setup.php

# Install laravel
ENV COMPOSER_ALLOW_SUPERUSER=1 PATH=~/.config/composer/vendor/bin:$PATH
RUN composer global require laravel/breeze

# Create sample blog
RUN composer create-project --prefer-dist laravel/laravel QRGenerator

# Change working directory to the Laravel project
WORKDIR QRGenerator
RUN composer install

RUN npm install
RUN BACKGROUND php artisan serve --host 0.0.0.0 --port 80

RUN BACKGROUND npm run dev

# Expose website creates a unique link to view the website running in the server
EXPOSE WEBSITE http://localhost:80
